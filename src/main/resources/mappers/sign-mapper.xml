<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="signMapper">
	
	<resultMap id="signResult" type="Sign">
		<result column="appr_no" property="apprNo" />
		<result column="appr_title" property="apprTitle" />
		<result column="appr_content" property="apprContent" />
		<result column="enroll_date" property="enrollDate" />
		<result column="appr_status" property="apprStatus" />
		<result column="appr_storage" property="apprStorage" />
		<result column="origin_name" property="originName" />
		<result column="change_name" property="changeName" />
		<result column="appr_total" property="apprTotal" />
		<result column="emp_no" property="empNo" />
		<result column="form_no" property="formNo" />
		<result column="form_title" property="formTitle" />
		<result column="emp_name" property="empName" />
	</resultMap>
	
	<resultMap id="formResult" type="Form">
		<result column="form_no" property="formNo" />
		<result column="form_title" property="formTitle" />
		<result column="form_content" property="formContent" />
		<result column="form_type" property="formType" />
		<result column="form_status" property="formStatus" />
		<result column="form_info" property="formInfo" />
		<result column="enroll_date" property="enrollDate" />
	</resultMap>
	
	<!-- 관리자_결재양식 리스트 조회 -->
	<select id="selectListCount" resultType="_int">
		select
			   count(*)
		  from appr_form
		 where form_del = 'N'
	</select>

	<select id="selectFormList" resultMap="formResult">
		select 
			   form_no
			 , form_title
			 , form_type
			 , form_status
			 , form_info
			 , to_char(enroll_date, 'YYYY-MM-DD') AS "enroll_date"
		  from appr_form
		 where form_del = 'N'
		 order
		    by form_no desc
	</select>
	
	<!-- 관리자_결재양식 상세조회 -->
	<select id="selectFormDetail" resultMap="formResult">
		select
			   form_no
			 , form_title
			 , form_content
			 , form_status
			 , form_info
		  from appr_form
		 where form_no = #{formNo}
	</select>
	
	<!-- 관리자_결재양식 수정 -->
	<update id="updateForm">
		update
		       appr_form
		   set form_title = #{formTitle}
		     , form_content = #{formContent}
		     , form_status = #{formStatus}
		     , form_info = #{formInfo}
		     , modify_date = sysdate
		 where form_no = #{formNo}
	</update>
	
	<!-- 관리자_결재양식 추가 -->
	<insert id="insertForm">
		insert 
		  into appr_form
		  (
		    form_no
		  , form_title
		  , form_content
		  , form_status
		  , form_info
		  )
		  values
		  (
		    seq_afno.nextval
		  , #{formTitle}
		  , #{formContent}
		  , #{formStatus}
		  , #{formInfo}
		  )
	</insert>
	
	<!-- 관리자_결재양식 삭제 -->
	<update id="deleteForm">
		update
			   appr_form
		   set modify_date = sysdate
		     , form_del = 'Y'
		 where form_no = #{formNo}
	</update>
	
	<!-- 사용자_결재양식선택 리스트 조회 -->
	<select id="selectApprFormList" resultMap="formResult">
		select 
			   form_no
			 , form_title
			 , form_info
		  from appr_form
		 where form_del = 'N'
		   and form_type = '일반'
		   and form_status = 'Y'
		 order
		    by form_no desc
	</select>
	
	<!-- 사용자_결재대기함 페이지 -->
	<select id="selectApprListCount" resultType="_int">
		select
			   count(*)
		  from approval
		 where appr_status = '대기'
		   and appr_storage = 'N'
	</select>
	
	<select id="selectApprStandbyList" resultMap="signResult">
		select
			   appr_no
			 , appr_title
			 , to_char(v.enroll_date, 'YYYY-MM-DD') as "enroll_date"
			 , form_title
			 , emp_name
		  from approval v
		  join appr_form f on (v.form_no = f.form_no)
		  join member m on (v.emp_no = m.emp_no)
		 where appr_status = '대기'
		   and appr_storage = 'N'
		 order
		    by appr_no desc
	</select>

</mapper>