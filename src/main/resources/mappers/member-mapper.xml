<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
	
	<resultMap id="memberResult" type="Member">
		<result column="emp_no" property="empNo" />
		<result column="emp_name" property="empName" />
		<result column="emp_pwd" property="empPwd" />
		<result column="phone" property="phone" />
		<result column="email" property="email" />
		<result column="profile_originname" property="originName" />
		<result column="profile_path" property="path" />
		<result column="status" property="status" />
		<result column="job_no" property="jobNo" />
		<result column="dept_no" property="deptNo" />
		<result column="job_name" property="jobName" />
		<result column="dept_name" property="deptName" />
	</resultMap>
	
	<resultMap id="deptResult" type="Dept">
		<result column="dept_no" property="deptNo" />
		<result column="upper_no" property="upperNo" />
		<result column="dept_name" property="deptName" />
	</resultMap>
	
	<!-- 사용자_결재라인 조직도 리스트 조회 -->
	<select id="selectApprLineList" resultMap="memberResult">
		select
			   emp_no
			 , emp_name
			 , m.dept_no
			 , upper_no
			 , dept_name
			 , job_name
		  from member m 
		  join department d on (m.dept_no = d.dept_no)
		  join job j on (m.job_no = j.job_no)
		 where status = 'Y'
		 order
		    by m.job_no
	</select>
	
	<!-- 사용자_결재라인 조직도 부서 조회 -->
	<select id="selectApprLineDept" resultMap="deptResult">
		select
		       dept_no
		     , dept_name
		     , upper_no
		  from department
	</select>
	
	<!-- 사용자_결재라인 사원 조회 -->
	<select id="selectApprEmp" resultMap="memberResult">
		select
			   emp_no
		     , emp_name
		     , dept_name
		     , job_name
		  from member
		  join department using (dept_no)
		  join job using (job_no)
		 where emp_no = #{empNo}
	</select>
	
	<select id="loginMember" resultMap="memberResult">
		select 
			    emp_no
			  , emp_name
			  , emp_pwd
			  , phone
			  , email
			  , profile_originname
			  , profile_path
			  , status
			  , vac_all
			  <!-- , vac_remain -->
			  , job_no
			  , dept_no
			  , job_name
		   from member
           join job using (job_no)
		  where status = 'Y'
		    and emp_no = #{empNo}
		    and emp_pwd = #{empPwd}
	</select>

	<update id="updatePwd">
		update
			   member
		   set emp_pwd = #{empPwd}
		 where emp_no = #{empNo}
	</update>
	

</mapper>
